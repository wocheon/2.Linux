# GKE GPU 노드 유지보수 정책 종합 정리

GCP의 GKE 환경에서 GPU 노드를 운영할 때 유지보수 정책과 관련된 중요 사항을 체계적으로 정리한 문서입니다.

## GKE 유지보수 정책의 기본 개념

GKE에서는 클러스터와 노드풀 각각에 유지보수 정책을 설정할 수 있습니다. 유지보수 정책은 다음과 같은 핵심 요소로 구성됩니다:

- **유지보수 기간**: 지정한 시간대에만 유지보수가 실행되도록 제한하는 설정
    - 예: 월~일 간 오전 1:00~04:00까지만 유지보수 동작 허용
    - 32일의 순환 기간 동안 최소 48시간의 유지보수를 허용해야 함[^1]
- **유지보수 제외**: 지정한 일자 및 시간 동안 특정 업그레이드 작업을 실행하지 못하도록 하는 설정
    - 예: 2025-03-01 09:00 ~ 2025-03-31 00:00까지 업그레이드 불가[^1]


## 클러스터 유지보수 정책과 노드풀 유지보수 정책의 차이

GKE에서 클러스터 유지보수 정책과 노드풀 유지보수 정책은 서로 다른 대상과 영향 범위를 가집니다:


| 설정 대상 | 적용 범위 | 유지보수 대상 | 영향 받는 요소 |
| :-- | :-- | :-- | :-- |
| **클러스터 유지보수 정책** | 클러스터 단위 | Control Plane (kube-apiserver, etcd) | 클러스터 API 다운타임 |
| **노드풀 유지보수 정책** | 노드풀 단위 | 개별 노드 (Worker Nodes) | 노드 재시작, 업그레이드 |

중요한 점은 **클러스터에 유지보수 정책을 설정했다고 해서 노드풀이 자동으로 이 정책을 따르지 않는다는 것**입니다. 각 노드풀마다 개별적으로 유지보수 정책을 설정해야 합니다[^1].

## GPU 노드와 비-GPU 노드의 차이점

GPU를 가진 노드와 일반 노드는 유지보수 및 운영 특성에서 중요한 차이가 있습니다:


| **구분** | **GPU 노드** | **비-GPU 노드** |
| :-- | :-- | :-- |
| **라이브 마이그레이션** | 지원하지 않음. 유지보수 시 노드가 종료됨 | 대부분 라이브 마이그레이션으로 다운타임 없이 유지보수 수행 |
| **유지보수 정책 적용** | 클러스터 유지보수 정책을 따르지 않고 즉시 유지보수가 발생할 가능성 있음 | 일반적으로 클러스터의 유지보수 정책을 따름 |
| **작업 중단 대응** | 종료 전 `SIGTERM` 신호를 받아 작업 정리 기회 제공 | 동일한 `SIGTERM` 신호를 받지만, 라이브 마이그레이션으로 중단 가능성이 낮음 |
| **호스트 이벤트 처리** | 하드웨어 특성상 호스트 이벤트 시 종료 필요 | 대부분 호스트 이벤트 시에도 라이브 마이그레이션으로 처리 가능 |

## 유지보수 정책을 따르지 않는 주요 사례

GPU 노드뿐만 아니라 일반 노드도 다음과 같은 상황에서는 유지보수 정책을 따르지 않고 유지보수가 발생할 수 있습니다:

1. **Google Cloud 서비스의 유지보수**: GKE 노드는 Google Compute Engine VM으로 관리되며, Compute Engine에서 발생하는 호스트 이벤트(하드웨어 유지보수, 오류)는 GKE 유지보수 정책과 관계없이 진행될 수 있습니다[^1]
2. **제어 영역 복구 작업**: 클러스터 안정성을 보장하기 위한 제어 영역(Control Plane) 복구 작업은 즉시 수행되며, 이 과정에서 노드풀에도 영향을 미칠 수 있습니다[^1]
3. **수동 변경 작업**: 사용자가 직접 수행하는 일부 수동 변경 작업(노드풀 구성 변경, 네트워크 정책 설정, Shielded Nodes 활성화 등)은 유지보수 정책을 무시하고 즉시 적용됩니다[^1]
4. **자원 부족 상황에서의 업그레이드**: 자원이 제한된 환경에서 GKE가 추가 리소스를 확보하지 못할 경우, 노드풀 업그레이드가 즉시 진행될 수 있습니다[^1]

## 클라우드 제공업체 간 GPU 노드 유지보수 정책 비교

GKE의 GPU 노드 유지보수 정책 문제는 다른 클라우드 제공업체에서도 유사하게 발생합니다:

### AWS (EKS)

- EC2 인스턴스는 일반적으로 유지보수 전에 사전 알림을 제공하지만, 긴급 보안 패치, 하드웨어 장애, 또는 호스트 시스템 유지보수가 필요한 경우 사용자의 유지보수 정책과 무관하게 인스턴스가 재부팅되거나 종료될 수 있습니다[^1]
- GPU 인스턴스(P-family, G-family 등)도 호스트 수준의 유지보수가 필요하면 자동으로 다른 호스트로 마이그레이션되거나 종료될 수 있습니다[^1]


### Azure (AKS)

- Azure의 GPU VM은 일반 VM과 동일한 유지보수 정책을 가지지만, Azure 플랫폼의 패치, 하드웨어 장애, 긴급 보안 업데이트가 필요한 경우에는 유지보수 정책이 적용되지 않고 노드가 강제 재시작될 수 있습니다[^1]
- AKS의 유지보수 정책을 통해 특정 시간 동안 유지보수를 연기할 수는 있지만, 장애 복구나 긴급 보안 업데이트가 필요한 경우 유지보수가 강제로 수행될 수 있습니다[^1]


## 결론 및 권장사항

GKE, AWS, Azure 모두 GPU 노드에 대해 유지보수 정책이 항상 보장되지 않습니다. 긴급 유지보수, 하드웨어 장애, 보안 패치 등의 이유로 예고 없이 노드가 재부팅되거나 교체될 수 있습니다[^1].

### 권장사항

1. **클러스터와 노드풀 모두에 유지보수 정책 설정**: 클러스터 유지보수 정책만 설정하면 노드풀 유지보수는 영향을 받지 않으므로, 각 노드풀에도 개별적으로 유지보수 정책을 설정해야 합니다[^1]
2. **GPU 워크로드 설계 시 고려사항**:
    - 작업 중단 대비 설계
    - 워크로드 체크포인트 기능 구현
    - 노드 장애 및 강제 유지보수에 대비한 이중화 및 장애 복구 전략 마련[^1]
3. **지속적인 모니터링**: GPU 노드의 상태를 지속적으로 모니터링하고, 유지보수 이벤트에 대응할 수 있는 자동화된 시스템 구축[^1]

이러한 전략을 통해 GPU 노드의 유지보수로 인한 워크로드 영향을 최소화할 수 있습니다.