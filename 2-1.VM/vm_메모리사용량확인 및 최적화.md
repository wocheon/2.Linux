# VM 메모리 사용량 확인 및 최적화 방법

## 1. /proc/meminfo에서 주요 항목 확인
`/proc/meminfo`에서 메모리 상태를 확인할 수 있는 주요 항목은 다음과 같습니다:

- **Total**: 시스템의 전체 메모리
- **Free**: 사용되지 않는 메모리
- **Buffers**: 디스크 버퍼로 사용되는 메모리
- **Cached**: 파일 시스템 캐시로 사용되는 메모리
- **Shmem**: 공유 메모리
- **MemAvailable**: 시스템에서 실제로 사용할 수 있는 메모리
- **Used**: 현재 사용 중인 메모리 (Total - Free - Buffers - Cached)

### 예시 `/proc/meminfo` 출력:
```bash
MemTotal:        8192000 kB
MemFree:         1024000 kB
Buffers:          512000 kB
Cached:          2048000 kB
Shmem:            256000 kB
MemAvailable:    4096000 kB
```

### 주요 항목 설명:
- **Used 메모리**: 실제 애플리케이션과 시스템 프로세스가 사용하는 메모리
- **Free 메모리**: 사용되지 않는 메모리
- **Buffers**와 **Cached**: 시스템 성능 향상을 위한 캐시 메모리

---

## 2. 메모리의 `buffer/cached` 비율이 높은 VM에서 확인 방법

### 1. Active/Inactive(file)의 값이 높은 경우
- **원인**: 파일 시스템 캐시가 많이 쌓인 경우.
- **해결책**: 파일 시스템 캐시를 초기화해야 합니다. 그러나 파일 시스템 캐시는 다시 쌓이므로 주기적으로 초기화해야 합니다.

```sh
# 파일 시스템 캐시를 초기화
echo 3 > /proc/sys/vm/drop_caches
```

- **중요**: `Active/Inactive(anon)` 값에는 영향을 미치지 않으며, **익명 메모리**는 영향을 받지 않습니다.

### 2. Active/Inactive(anon) 값이 높은 경우
- **원인**: 애플리케이션에서 사용 중인 캐시 또는 익명 메모리가 많다는 것을 의미합니다.
- **해결책**: 애플리케이션 캐시를 초기화하거나 메모리 최적화를 통해 해결할 수 있습니다.

---

## 3. 메모리 사용량 관련 주요 계산

### `Used`, `Free`, `Shared`, `Available` 메모리 값 계산:

- **Used**:
  ```bash
  Used = Total - Free - Buffers - Cached
  ```

- **Free**: 
  ```bash
  Free = MemFree
  ```

- **Shared**: 
  ```bash
  Shared = Shmem
  ```

- **Available**:
  ```bash
  Available = MemAvailable
  ```

### 메모리 항목 상세 설명:
- **`Total`**: 시스템 전체 메모리
- **`Free`**: 아무도 사용하지 않는 메모리
- **`Buffers`**: 디스크 I/O 버퍼 메모리
- **`Cached`**: 파일 시스템 캐시 메모리
- **`Shmem`**: 공유 메모리
- **`MemAvailable`**: 새로 시작할 수 있는 프로세스가 사용할 수 있는 메모리

---

## 4. 메모리 사용량 확인 시 고려할 점

### 메모리 사용량 확인 시 `buffer`와 `cached` 메모리를 고려하는 이유:
1. **버퍼와 캐시는 시스템 성능 최적화**에 사용되며, 실제로 애플리케이션이 사용하는 메모리가 아니지만 **다시 비워져서 다른 프로세스가 사용할 수 있습니다**.
2. **`Used`와 `Free` 메모리**: `Used` 메모리는 실제 애플리케이션과 시스템 프로세스가 사용하는 메모리로, `Free` 메모리는 아무도 사용하지 않는 메모리입니다.
3. **`Available` 메모리**: 새로 시작할 수 있는 프로세스가 사용할 수 있는 메모리로, `Free` 메모리와 캐시 메모리도 고려됩니다.

### 메모리 상태를 정확하게 파악하려면 **`Used`**와 **`Available`** 메모리를 함께 살펴보는 것이 좋습니다.

---

## 5. 결론

- **`buffer/cached` 비율이 높은 VM에서** `/proc/meminfo`를 확인할 때, `Active/Inactive(file)` 값이 높은 경우 **파일 시스템 캐시**가 많이 쌓인 것임을 알 수 있습니다. 이 경우 파일 시스템 캐시를 초기화하면 됩니다. 하지만 파일 시스템 캐시는 **주기적으로** 초기화해야 합니다.
  
- **`Active/Inactive(anon)` 값이 높은 경우**는 **애플리케이션 캐시**나 **익명 메모리**가 많이 사용되고 있다는 것을 의미합니다. 이 경우 애플리케이션 캐시 초기화나 메모리 최적화가 필요합니다.

- **`buffer/cached` 메모리는 실제로 사용되지 않지만, 필요시 다른 프로세스가 사용할 수 있는 메모리이므로**, **메모리 상태를 평가할 때 이를 고려하는 것이 중요**합니다.
  
- **`Used`와 `Available` 메모리**를 함께 고려하여 시스템의 실제 메모리 상태를 파악하는 것이 바람직합니다.
